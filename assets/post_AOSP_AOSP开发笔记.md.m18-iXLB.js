import{_ as a,o as s,c as i,a6 as e}from"./chunks/framework.DnJfIKBR.js";const u=JSON.parse('{"title":"AOSP开发笔记","description":"","frontmatter":{"title":"AOSP开发笔记","layout":"doc","aside":false},"headers":[],"relativePath":"post/AOSP/AOSP开发笔记.md","filePath":"post/AOSP/AOSP开发笔记.md","lastUpdated":1716708622000}'),t={name:"post/AOSP/AOSP开发笔记.md"},r=e(`<hr><h3 id="aosp-目录结构说明" tabindex="-1">AOSP 目录结构说明 <a class="header-anchor" href="#aosp-目录结构说明" aria-label="Permalink to &quot;AOSP 目录结构说明&quot;">​</a></h3><ul><li><strong><code>bionic</code></strong>: 包含 Android 的 C 标准库（libc）、数学库（libm）、动态链接器（linker）等基本库的实现。专为 Android 设计，优化了性能和内存使用。</li><li><strong><code>bootable</code></strong>: 包含启动相关的代码，例如 recovery 系统，用于更新和恢复设备的小型独立操作系统。</li><li><strong><code>build</code></strong>: 包含构建系统的核心脚本和配置文件，用于编译 Android 源代码和生成系统镜像。</li><li><strong><code>cts</code></strong>: Compatibility Test Suite（兼容性测试套件），用于验证设备兼容性以确保应用在所有设备上的一致性表现。</li><li><strong><code>dalvik</code></strong> (在较新版本的 Android 中已被移除): 早期 Android 版本使用的 Dalvik 虚拟机的源代码。</li><li><strong><code>development</code></strong>: 包含用于开发和测试的应用程序和工具，例如模拟器配置、测试工具等。</li><li><strong><code>device</code></strong>: 包含特定硬件设备的代码和资源，如设备制造商和运营商的定制。</li><li><strong><code>docs</code></strong>: 项目文档。</li><li><strong><code>external</code></strong>: 包含 Android 系统使用的第三方库和工具。</li><li><strong><code>frameworks</code></strong>: 包含大部分的 Android 框架层代码，支持所有 Android 应用运行的核心组件。</li><li><strong><code>hardware</code></strong>: 包含与硬件相关的接口和抽象层代码，支持不同的硬件组件。</li><li><strong><code>libcore</code></strong>: 包含 Android 核心库，例如 Java 核心库的实现。</li><li><strong><code>out</code></strong>: 编译过程中生成的输出文件存放位置，包括最终的系统镜像文件。</li><li><strong><code>packages</code></strong>: 包含 Android 中的标准应用程序和库，例如电话、联系人应用和 WebView。</li><li><strong><code>prebuilts</code></strong>: 包含编译 Android 源代码所需的预编译工具和库。</li><li><strong><code>system</code></strong>: 包含操作系统的核心组件，如 init 进程和各种系统服务。</li><li><strong><code>vendor</code></strong>: 通常包含供应商特定的代码和资源，这些通常是与特定硬件密切相关的。</li></ul><hr><h3 id="替换framework" tabindex="-1">替换framework <a class="header-anchor" href="#替换framework" aria-label="Permalink to &quot;替换framework&quot;">​</a></h3><p>编译framework<br> 模块路径<code>/framework/base/Android.bp</code><code>out/target/product/flame/system/framework/framework.jar</code></p><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">make</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> framework-minus-apex</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">cp</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> out/target/product/flame/system/framework/framework.jar</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /system/framework/framework.jar</span></span></code></pre></div><p>删除优化文件 .art .oat .vdex<br><code>/system/framework/oat</code><br><code>/system/framework/arm</code><br><code>/system/framework/arm64</code></p><p>重启zygote</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span>adb shell stop</span></span>
<span class="line"><span>adb shell start</span></span></code></pre></div><h3 id="android-文件格式说明" tabindex="-1">Android 文件格式说明 <a class="header-anchor" href="#android-文件格式说明" aria-label="Permalink to &quot;Android 文件格式说明&quot;">​</a></h3><ul><li><p><strong>.OAT 文件（Optimized Android File）</strong>:</p><ul><li><code>.oat</code> 文件包含了为 Android 设备优化后的应用程序代码。当 APK 文件安装到设备上时，Android 的运行时环境（ART）会将 APK 中的 DEX 文件编译成机器码，这个过程称为“预编译”或“AOT 编译（Ahead-of-Time Compilation）”，编译后的代码就存储在 <code>.oat</code> 文件中。<code>.oat</code> 文件使应用程序启动更快，因为它直接运行编译后的机器码，而不是每次都从原始字节码开始。</li></ul></li><li><p><strong>.ODEX 文件（Optimized DEX）</strong>:</p><ul><li><code>.odex</code> 文件是 Android 应用中分离的优化的 DEX 文件。在早期 Android 版本中，系统应用常常将 DEX 文件（包含字节码）预编译成 <code>.odex</code> 文件来提升启动速度和系统性能。<code>.odex</code> 文件减少了在应用启动时的 CPU 耗时，因为它已经是预处理和优化过的代码。</li></ul></li><li><p><strong>.VDEX 文件（Verified DEX）</strong>:</p><ul><li><code>.vdex</code> 文件是在 Android 8（Oreo）引入的，包含了验证后的 DEX 文件。这些文件用于存储经过验证但未优化的 DEX 文件，从而加快了应用的安装过程以及 ART 的 JIT（即时编译）过程。</li></ul></li><li><p><strong>.ART 文件</strong>:</p><ul><li><code>.art</code> 文件格式与 Android 的运行时（ART）环境相关，主要用于存储预编译的应用代码。不过，在实际使用中，<code>.art</code> 文件并不常见，因为 Android 主要使用 <code>.oat</code> 文件来存储这类信息。</li></ul></li></ul><h3 id="创建分支" tabindex="-1">创建分支 <a class="header-anchor" href="#创建分支" aria-label="Permalink to &quot;创建分支&quot;">​</a></h3><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">repo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> start</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> android-12.0.0_r34_hack</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --all</span></span></code></pre></div><h3 id="下载github-desktop" tabindex="-1">下载Github Desktop <a class="header-anchor" href="#下载github-desktop" aria-label="Permalink to &quot;下载Github Desktop&quot;">​</a></h3><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ALL_PROXY</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;http://192.168.2.12:7890&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#配置源</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">wget</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -qO</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> -</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> https://mirror.mwt.me/shiftkey-desktop/gpgkey</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> gpg</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --dearmor</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> tee</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /usr/share/keyrings/mwt-desktop.gpg</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &gt;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /dev/null</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> sh</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -c</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;echo &quot;deb [arch=amd64 signed-by=/usr/share/keyrings/mwt-desktop.gpg] https://mirror.mwt.me/shiftkey-desktop/deb/ any main&quot; &gt; /etc/apt/sources.list.d/mwt-desktop.list&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#安装github-desktop</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apt</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> update</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> &amp;&amp; </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> apt</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> github-desktop</span></span></code></pre></div><h3 id="几种读取属性的办法" tabindex="-1">几种读取属性的办法 <a class="header-anchor" href="#几种读取属性的办法" aria-label="Permalink to &quot;几种读取属性的办法&quot;">​</a></h3><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Settings.Secure.getInt(getContentResolver(</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),Settings.Secure.ADB_ENABLED)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">android.os.SystemProperties.get(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">&quot;ro.debuggable&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">adb</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> shell</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> getprop</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ro.debuggable</span></span></code></pre></div><h4 id="新增api-要重新生成文档" tabindex="-1">新增API 要重新生成文档 <a class="header-anchor" href="#新增api-要重新生成文档" aria-label="Permalink to &quot;新增API 要重新生成文档&quot;">​</a></h4><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">make</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> update-api</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">make</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> api-stubs-docs-update-current-api</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">make</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> api-stubs-docs-non-updatable-update-current-api</span></span></code></pre></div><h4 id="读取log" tabindex="-1">读取log <a class="header-anchor" href="#读取log" aria-label="Permalink to &quot;读取log&quot;">​</a></h4><div class="language-sh vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki shiki-themes github-light github-dark vp-code"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">#-E匹配多个条件,用|分割</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">adb</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> logcat</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> grep</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -E</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;MyGame|Settings&quot;</span></span></code></pre></div><h2 id="参阅" tabindex="-1">参阅 <a class="header-anchor" href="#参阅" aria-label="Permalink to &quot;参阅&quot;">​</a></h2><blockquote><ul><li><a href="https://huanle19891345.github.io/en/android/art/jni/jni%E6%95%B0%E6%8D%AE%E8%BD%AC%E6%8D%A2/" target="_blank" rel="noreferrer">https://huanle19891345.github.io/en/android/art/jni/jni数据转换/</a> 记录着一些art转换的代码</li><li><a href="https://evilpan.com/2021/12/26/art-internal/" target="_blank" rel="noreferrer">https://evilpan.com/2021/12/26/art-internal/</a> 比较详尽的android runtime 初始化流程</li><li><a href="https://segmentfault.com/a/1190000038357455" target="_blank" rel="noreferrer">https://segmentfault.com/a/1190000038357455</a> Context详解</li><li><a href="https://lixiaogang03.github.io/2021/01/11/Android-AppOpsService/" target="_blank" rel="noreferrer">https://lixiaogang03.github.io/2021/01/11/Android-AppOpsService/</a></li><li><a href="https://bbs.kanxue.com/thread-274396.htm" target="_blank" rel="noreferrer">https://bbs.kanxue.com/thread-274396.htm</a> android源码调试</li><li><a href="https://www.cnblogs.com/alisecurity/p/5501832.html" target="_blank" rel="noreferrer">https://www.cnblogs.com/alisecurity/p/5501832.html</a> 让某个方法解释执行</li><li><a href="https://www.cnblogs.com/hellokitty2/p/11248975.html" target="_blank" rel="noreferrer">https://www.cnblogs.com/hellokitty2/p/11248975.html</a> 编译选项(user eng userdebug) 详细说明</li><li><a href="https://juejin.cn/post/7236915296963428408" target="_blank" rel="noreferrer">https://juejin.cn/post/7236915296963428408</a> 深入理解Android-Runtime</li><li><a href="https://www.jianshu.com/p/c113ad606080" target="_blank" rel="noreferrer">https://www.jianshu.com/p/c113ad606080</a> (UID Userid appid 注解)</li><li><a href="https://miuiver.com/aosp-rom-of-xiaomi/" target="_blank" rel="noreferrer">https://miuiver.com/aosp-rom-of-xiaomi/</a></li><li><a href="https://ukdiss.com/examples/android-instrumentation-aspect-oriented-programming.php" target="_blank" rel="noreferrer">https://ukdiss.com/examples/android-instrumentation-aspect-oriented-programming.php</a> 安卓源码AOP</li><li><a href="https://zsxwz.com/2021/03/17/%E4%BD%BF%E7%94%A8dex2oat%E7%BC%96%E8%AF%91%E4%BC%98%E5%8C%96app%EF%BC%8C%E6%8F%90%E5%8D%87%E8%BF%90%E8%A1%8C%E9%80%9F%E5%BA%A6%EF%BC%8C%E6%97%A0%E9%9C%80root-adb/" target="_blank" rel="noreferrer">https://zsxwz.com/2021/03/17/使用dex2oat编译优化app，提升运行速度，无需root-adb/</a></li><li><a href="https://juejin.cn/post/7016531198516133902" target="_blank" rel="noreferrer">https://juejin.cn/post/7016531198516133902</a> Dex2Oat 优化说明</li><li><a href="https://www.reddit.com/r/androiddev/comments/mfkyr5/byte_buddy_on_android_made_possible/" target="_blank" rel="noreferrer">https://www.reddit.com/r/androiddev/comments/mfkyr5/byte_buddy_on_android_made_possible/</a></li><li><a href="https://www.jianshu.com/p/acfb5cdf385c" target="_blank" rel="noreferrer">https://www.jianshu.com/p/acfb5cdf385c</a> (10种AOP实现方式)</li><li><a href="https://cloud.tencent.com/developer/article/1689561" target="_blank" rel="noreferrer">https://cloud.tencent.com/developer/article/1689561</a> (一些参数说明)</li><li><a href="https://juejin.cn/post/7226327556197859386" target="_blank" rel="noreferrer">https://juejin.cn/post/7226327556197859386</a> (byte-buddy说明)</li><li><a href="https://cloud.tencent.com/developer/article/2106274" target="_blank" rel="noreferrer">https://cloud.tencent.com/developer/article/2106274</a> (vdex文件介绍)</li><li><a href="https://github.com/FudanSELab/How-to-replace-framework-in-AOSP" target="_blank" rel="noreferrer">https://github.com/FudanSELab/How-to-replace-framework-in-AOSP</a></li><li><a href="https://cs.android.com/" target="_blank" rel="noreferrer">在线阅读源码https://cs.android.com/</a></li><li><a href="https://github.com/foxleezh/AOSP" target="_blank" rel="noreferrer">Github阅读笔记</a></li><li><a href="https://github.com/Omooo/Android-Notes" target="_blank" rel="noreferrer">Android笔记</a>关于安卓的相关教程非常全</li><li><a href="https://www.kancloud.cn/alex_wsc/androids/473620" target="_blank" rel="noreferrer">老罗的安卓</a></li><li><a href="https://yuandaimaahao.github.io/AndroidFrameworkTutorialPages/" target="_blank" rel="noreferrer">https://yuandaimaahao.github.io/AndroidFrameworkTutorialPages/</a> AOPS学习笔记</li><li><a href="https://github.com/CoenQian/android-api-guide/tree/master" target="_blank" rel="noreferrer">https://github.com/CoenQian/android-api-guide/tree/master</a> 关于权限相关教程</li><li><a href="https://bbs.kanxue.com/thread-271358.htm" target="_blank" rel="noreferrer">FartExt超进化之奇奇怪怪的新ROM工具MikRom</a></li><li><a href="https://wwm0609.github.io/2018/03/07/pkms-permission/" target="_blank" rel="noreferrer">https://wwm0609.github.io/2018/03/07/pkms-permission/</a></li><li><a href="https://source.android.com/docs/setup/build/building-kernels?hl=zh-cn" target="_blank" rel="noreferrer">https://source.android.com/docs/setup/build/building-kernels?hl=zh-cn</a></li><li><a href="https://androidperformance.com/2021/10/26/build-android-12/#/1-%E4%BB%A3%E7%A0%81%E4%B8%8B%E8%BD%BD" target="_blank" rel="noreferrer">https://androidperformance.com/2021/10/26/build-android-12/#/1-代码下载</a></li><li><a href="https://github.com/eleme/lancet" target="_blank" rel="noreferrer">lancet</a> Android SDK可以使用的AOP框架</li><li><a href="https://windysha.github.io/2018/01/18/Android-AOP%E7%BC%96%E7%A8%8B%E7%9A%84%E5%9B%9B%E7%A7%8D%E7%AD%96%E7%95%A5%E6%8E%A2%E8%AE%A8%EF%BC%9AAspectj%EF%BC%8Ccglib-dexmaker%EF%BC%8CJavassist%EF%BC%8Cepic-dexposed/" target="_blank" rel="noreferrer">https://windysha.github.io/2018/01/18/Android-AOP编程的四种策略探讨：Aspectj，cglib-dexmaker，Javassist，epic-dexposed/</a></li></ul></blockquote>`,24),n=[r];function l(o,h,d,p,k,c){return s(),i("div",null,n)}const m=a(t,[["render",l]]);export{u as __pageData,m as default};
